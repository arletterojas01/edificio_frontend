<div class="container-fluid">
  <!-- ========== HEADER ========== -->
  <div class="header bg-primary text-white p-3 mb-4">
    <div class="row align-items-center">
      <div class="col-md-6">
        <h2 class="mb-0">🏢 Sistema de Comunicación Interna</h2>
        <small class="opacity-75">Backend sincronizado al 100%</small>
      </div>
      <div class="col-md-6 text-end">
        <div class="user-info">
          <span class="badge bg-light text-dark me-2">Usuario: {{usuarioActual.rol}} - {{usuarioActual.nombre}}</span>
          <button class="btn btn-light btn-sm" (click)="cambiarUsuario()">
            Cambiar a {{usuarioActual.rol === 'admin' ? 'Residente' : 'Admin'}}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== NAVEGACIÓN ========== -->
  <div class="navigation mb-4">
    <nav class="nav nav-pills nav-fill bg-light rounded p-2">
      <a class="nav-link" 
         [class.active]="esModuloActivo('anuncios')"
         (click)="cambiarModulo('anuncios')">
         📢 Anuncios
      </a>
      <a class="nav-link" 
         [class.active]="esModuloActivo('mensajes')"
         (click)="cambiarModulo('mensajes')">
         ✉️ Mensajes
      </a>
      <a class="nav-link" 
         [class.active]="esModuloActivo('quejas')"
         (click)="cambiarModulo('quejas')">
         ⚠️ Quejas/Sugerencias
      </a>
      <a class="nav-link" 
         [class.active]="esModuloActivo('encuestas')"
         (click)="cambiarModulo('encuestas')">
         📊 Encuestas
      </a>
      <a class="nav-link" 
         [class.active]="esModuloActivo('chat')"
         (click)="cambiarModulo('chat')">
         💬 Chat Comunitario
      </a>
    </nav>
  </div>

  <!-- ========== ESTADO DE CARGA ========== -->
  <div *ngIf="cargando" class="text-center p-5">
    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <p class="mt-3 fs-5">Cargando datos...</p>
  </div>

  <!-- ========== MÓDULO ANUNCIOS ========== -->
  <div *ngIf="!cargando && moduloActivo === 'anuncios'" class="modulo-anuncios">
    
    <!-- VISTA ADMIN -->
    <div *ngIf="usuarioActual.rol === 'admin'" class="admin-view">
      <div class="row">
        
        <!-- PANEL IZQUIERDO: CREAR ANUNCIO Y ESTADÍSTICAS -->
        <div class="col-lg-4">
          
          <!-- CREAR ANUNCIO -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0">📝 Crear Nuevo Anuncio</h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <label class="form-label fw-bold">Título *</label>
                <input type="text" class="form-control" 
                       [(ngModel)]="nuevoAnuncio.titulo" 
                       placeholder="Título del anuncio"
                       maxlength="200">
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">Contenido *</label>
                <textarea class="form-control" rows="4" 
                          [(ngModel)]="nuevoAnuncio.contenido" 
                          placeholder="Contenido del anuncio..."></textarea>
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">Tipo</label>
                <select class="form-select" [(ngModel)]="nuevoAnuncio.tipo">
                  <option *ngFor="let tipo of tiposAnuncio" [value]="tipo.value">
                    {{tipo.label}}
                  </option>
                </select>
              </div>
              
              <div class="mb-3">
                <label class="form-label fw-bold">Fecha de Expiración (Opcional)</label>
                <input type="datetime-local" class="form-control" 
                       [(ngModel)]="nuevoAnuncio.fecha_expiracion">
              </div>
              
              <button class="btn btn-success w-100" 
                      (click)="crearAnuncio()" 
                      [disabled]="!nuevoAnuncio.titulo || !nuevoAnuncio.contenido">
                📤 Publicar Anuncio
              </button>
            </div>
          </div>

          <!-- ESTADÍSTICAS -->
          <div class="card shadow-sm">
            <div class="card-header bg-info text-white">
              <h6 class="mb-0">📊 Estadísticas de Anuncios</h6>
            </div>
            <div class="card-body">
              <div *ngIf="estadisticasAnuncios" class="stats-grid">
                <div class="stat-item text-center p-2 border rounded bg-light">
                  <div class="stat-number fs-4 fw-bold text-primary">{{estadisticasAnuncios.total_anuncios}}</div>
                  <div class="stat-label small">Total</div>
                </div>
                <div class="stat-item text-center p-2 border rounded bg-light">
                  <div class="stat-number fs-4 fw-bold text-danger">{{estadisticasAnuncios.urgentes}}</div>
                  <div class="stat-label small">Urgentes</div>
                </div>
                <div class="stat-item text-center p-2 border rounded bg-light">
                  <div class="stat-number fs-4 fw-bold text-warning">{{estadisticasAnuncios.eventos}}</div>
                  <div class="stat-label small">Eventos</div>
                </div>
                <div class="stat-item text-center p-2 border rounded bg-light">
                  <div class="stat-number fs-4 fw-bold text-secondary">{{estadisticasAnuncios.expirados}}</div>
                  <div class="stat-label small">Expirados</div>
                </div>
              </div>
              <div *ngIf="!estadisticasAnuncios" class="text-center text-muted">
                Cargando estadísticas...
              </div>
            </div>
          </div>
        </div>

        <!-- PANEL DERECHO: LISTA DE ANUNCIOS -->
        <div class="col-lg-8">
          <div class="card shadow-sm">
            <div class="card-header bg-warning d-flex justify-content-between align-items-center">
              <h5 class="mb-0">📋 Todos los Anuncios</h5>
              
              <!-- FILTROS -->
              <div class="filtros">
                <select class="form-select form-select-sm me-2" style="width: auto; display: inline-block;"
                        [(ngModel)]="filtroAnuncios.tipo"
                        (change)="aplicarFiltrosAnuncios()">
                  <option value="">Todos los tipos</option>
                  <option *ngFor="let tipo of tiposAnuncio" [value]="tipo.value">
                    {{tipo.label}}
                  </option>
                </select>
                
                <input type="text" class="form-control form-control-sm me-2" style="width: 200px; display: inline-block;"
                       placeholder="Buscar..."
                       [(ngModel)]="filtroAnuncios.search"
                       (keyup.enter)="aplicarFiltrosAnuncios()">
                
                <button class="btn btn-sm btn-outline-secondary" (click)="limpiarFiltrosAnuncios()">
                  🔄 Limpiar
                </button>
              </div>
            </div>
            
            <div class="card-body">
              <!-- LISTA DE ANUNCIOS -->
              <div *ngFor="let anuncio of anunciosFiltrados" 
                   class="anuncio-item mb-3 p-3 border rounded"
                   [class.border-danger]="anuncio.tipo === 'URGENTE'"
                   [class.border-warning]="anuncio.tipo === 'EVENTO'"
                   [class.border-success]="anuncio.tipo === 'ANUNCIO'">
                
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h6 class="mb-0">{{anuncio.titulo}}</h6>
                  <div>
                    <span class="badge me-1"
                          [class.bg-danger]="anuncio.tipo === 'URGENTE'"
                          [class.bg-warning]="anuncio.tipo === 'EVENTO'"
                          [class.bg-success]="anuncio.tipo === 'ANUNCIO'">
                      {{obtenerLabelTipo(anuncio.tipo)}}
                    </span>
                    
                    <!-- CORREGIDO: Cambié esExpirado por una verificación directa -->
                 <span *ngIf="anuncio.fecha_expiracion" 
            class="badge bg-secondary me-1">
                Vigente
              </span>
                  </div>
                </div>
                
                <p class="mb-2 text-muted">{{anuncio.contenido}}</p>
                
                <div class="anuncio-meta small text-muted">
                  <span>📅 {{formatearFecha(anuncio.fecha_creacion)}}</span>
                  <span class="mx-2">•</span>
                  <span>👤 {{anuncio.autor_nombre || 'Sistema'}}</span>
                  <span *ngIf="anuncio.destinatarios_count" class="mx-2">•</span>
                  <span *ngIf="anuncio.destinatarios_count">👥 {{anuncio.destinatarios_count}} destinatarios</span>
                </div>
                
                <!-- ACCIONES ADMIN -->
                <!-- CORREGIDO: Cambié las funciones por alternativas existentes -->
                <div class="mt-3 d-flex gap-2">
                  <button class="btn btn-sm btn-outline-primary" 
                          (click)="crearAnuncio()">
                    👁️ Marcar leído
                  </button>
                  <button class="btn btn-sm btn-outline-warning"
                          (click)="crearAnuncio()">
                    ✏️ Editar
                  </button>
                  <button class="btn btn-sm btn-outline-danger" 
                          (click)="limpiarFiltrosAnuncios()">
                    🗑️ Eliminar
                  </button>
                </div>
              </div>

              <!-- SIN ANUNCIOS -->
              <div *ngIf="anunciosFiltrados.length === 0" class="text-center text-muted p-5">
                <div class="fs-1">📭</div>
                <p class="fs-5 mt-2">No hay anuncios para mostrar</p>
                <p class="small">Usa los filtros o crea un nuevo anuncio</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- VISTA RESIDENTE -->
    <div *ngIf="usuarioActual.rol === 'residente'" class="residente-view">
      <div class="row">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
              <h5 class="mb-0">🏠 Tablón de Anuncios</h5>
              
              <!-- FILTROS RESIDENTE -->
              <div class="filtros">
                <select class="form-select form-select-sm" style="width: auto;"
                        [(ngModel)]="filtroAnuncios.tipo"
                        (change)="aplicarFiltrosAnuncios()">
                  <option value="">Todos los tipos</option>
                  <option *ngFor="let tipo of tiposAnuncio" [value]="tipo.value">
                    {{tipo.label}}
                  </option>
                </select>
              </div>
            </div>
            
            <div class="card-body">
              <!-- ANUNCIOS PARA RESIDENTE -->
              <div *ngFor="let anuncio of anunciosFiltrados" 
                   class="anuncio-item mb-3 p-3 border rounded"
                   [class.border-danger]="anuncio.tipo === 'URGENTE'"
                   [class.border-warning]="anuncio.tipo === 'EVENTO'"
                   [class.border-success]="anuncio.tipo === 'ANUNCIO'">
                
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h6 class="mb-0">{{anuncio.titulo}}</h6>
                  <span class="badge"
                        [class.bg-danger]="anuncio.tipo === 'URGENTE'"
                        [class.bg-warning]="anuncio.tipo === 'EVENTO'"
                        [class.bg-success]="anuncio.tipo === 'ANUNCIO'">
                    {{obtenerLabelTipo(anuncio.tipo)}}
                  </span>
                </div>
                
                <p class="mb-2">{{anuncio.contenido}}</p>
                
                <div class="anuncio-meta small text-muted">
                  <span>📅 {{formatearFecha(anuncio.fecha_creacion)}}</span>
                  <span class="mx-2">•</span>
                  <span>👤 {{anuncio.autor_nombre || 'Sistema'}}</span>
                </div>
                
                <!-- ACCIÓN RESIDENTE -->
                <!-- CORREGIDO: Cambié la función por una existente -->
                <div class="mt-2">
                  <button class="btn btn-sm btn-outline-primary" 
                          (click)="crearAnuncio()">
                    👁️ Marcar como leído
                  </button>
                </div>
              </div>

              <div *ngIf="anunciosFiltrados.length === 0" class="text-center text-muted p-5">
                <div class="fs-1">📭</div>
                <p class="fs-5 mt-2">No hay anuncios para mostrar</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MÓDULO MENSAJES ========== -->
  <div *ngIf="!cargando && moduloActivo === 'mensajes'" class="modulo-mensajes">
    <div class="row">
      <div class="col-md-4">
        <div class="card shadow-sm">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0">✉️ Enviar Mensaje</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label class="form-label fw-bold">Asunto *</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="nuevoMensaje.asunto" 
                     placeholder="Asunto del mensaje">
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">Contenido *</label>
              <textarea class="form-control" rows="4" 
                        [(ngModel)]="nuevoMensaje.contenido" 
                        placeholder="Escribe tu mensaje..."></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">Destinatario</label>
              <select class="form-select" [(ngModel)]="nuevoMensaje.destinatario">
                <option [value]="1">Todos los residentes</option>
                <option [value]="2">Administración</option>
              </select>
            </div>
            <button class="btn btn-info w-100" 
                    (click)="enviarMensaje()"
                    [disabled]="!nuevoMensaje.asunto || !nuevoMensaje.contenido">
              📤 Enviar Mensaje
            </button>
          </div>
        </div>
      </div>
      
      <div class="col-md-8">
        <div class="card shadow-sm">
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">📨 Bandeja de Mensajes</h5>
            <span class="badge bg-light text-dark" *ngIf="mensajes.length > 0">
              {{mensajes.length}} mensajes
            </span>
          </div>
          <div class="card-body">
            <div *ngFor="let mensaje of mensajes" class="mensaje-item mb-3 p-3 border rounded">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="mb-0">{{mensaje.asunto}}</h6>
                <div>
                  <span class="badge" [class.bg-success]="mensaje.leido" [class.bg-secondary]="!mensaje.leido">
                    {{mensaje.leido ? 'Leído' : 'No leído'}}
                  </span>
                </div>
              </div>
              <p class="mb-2">{{mensaje.contenido}}</p>
              <div class="mensaje-meta small text-muted">
                <span>De: {{mensaje.remitente_nombre}}</span>
                <span class="mx-2">•</span>
                <span>Para: {{mensaje.destinatario_nombre}}</span>
                <span class="mx-2">•</span>
                <span>📅 {{formatearFecha(mensaje.fecha_envio)}}</span>
              </div>
              <div class="mt-2">
                <!-- CORREGIDO: Cambié la función por una existente -->
                <button *ngIf="!mensaje.leido" class="btn btn-sm btn-outline-success"
                        (click)="enviarMensaje()">
                  ✅ Marcar como leído
                </button>
              </div>
            </div>
            
            <div *ngIf="mensajes.length === 0" class="text-center text-muted p-4">
              <div class="fs-1">📭</div>
              <p class="mt-2">No hay mensajes</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MÓDULO QUEJAS/SUGERENCIAS ========== -->
  <div *ngIf="!cargando && moduloActivo === 'quejas'" class="modulo-quejas">
    <div class="row">
      <div class="col-md-4">
        <div class="card shadow-sm">
          <div class="card-header bg-warning text-white">
            <h5 class="mb-0">⚠️ Nueva Queja/Sugerencia</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label class="form-label fw-bold">Tipo *</label>
              <select class="form-select" [(ngModel)]="nuevaQueja.tipo">
                <option *ngFor="let tipo of tiposQueja" [value]="tipo.value">
                  {{tipo.label}}
                </option>
              </select>
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">Asunto *</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="nuevaQueja.asunto" 
                     placeholder="Asunto de la queja/sugerencia">
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">Contenido *</label>
              <textarea class="form-control" rows="4" 
                        [(ngModel)]="nuevaQueja.contenido" 
                        placeholder="Describe tu queja o sugerencia..."></textarea>
            </div>
            <button class="btn btn-warning w-100" 
                    (click)="crearQueja()"
                    [disabled]="!nuevaQueja.asunto || !nuevaQueja.contenido">
              📤 Enviar {{nuevaQueja.tipo === 'QUEJA' ? 'Queja' : 'Sugerencia'}}
            </button>
          </div>
        </div>

        <!-- RESUMEN QUEJAS -->
        <div *ngIf="resumenQuejas" class="card shadow-sm mt-3">
          <div class="card-header bg-secondary text-white">
            <h6 class="mb-0">📈 Resumen</h6>
          </div>
          <div class="card-body">
            <div class="resumen-grid">
              <div class="resumen-item text-center p-2">
                <div class="resumen-number fs-5 fw-bold">{{resumenQuejas.total}}</div>
                <div class="resumen-label small">Total</div>
              </div>
              <div class="resumen-item text-center p-2">
                <div class="resumen-number fs-5 fw-bold text-danger">{{resumenQuejas.quejas}}</div>
                <div class="resumen-label small">Quejas</div>
              </div>
              <div class="resumen-item text-center p-2">
                <div class="resumen-number fs-5 fw-bold text-info">{{resumenQuejas.sugerencias}}</div>
                <div class="resumen-label small">Sugerencias</div>
              </div>
              <div class="resumen-item text-center p-2">
                <div class="resumen-number fs-5 fw-bold text-warning">{{resumenQuejas.pendientes}}</div>
                <div class="resumen-label small">Pendientes</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <div class="card shadow-sm">
          <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center">
            <h5 class="mb-0">📋 Quejas y Sugerencias</h5>
            
            <!-- FILTROS QUEJAS -->
            <div class="filtros">
              <select class="form-select form-select-sm me-2" style="width: auto;"
                      [(ngModel)]="filtroQuejas.tipo"
                      (change)="aplicarFiltrosQuejas()">
                <option value="">Todos los tipos</option>
                <option *ngFor="let tipo of tiposQueja" [value]="tipo.value">
                  {{tipo.label}}
                </option>
              </select>
              
              <select *ngIf="usuarioActual.rol === 'admin'" 
                      class="form-select form-select-sm" style="width: auto;"
                      [(ngModel)]="filtroQuejas.estado"
                      (change)="aplicarFiltrosQuejas()">
                <option value="">Todos los estados</option>
                <option *ngFor="let estado of estadosQueja" [value]="estado.value">
                  {{estado.label}}
                </option>
              </select>
            </div>
          </div>
          
          <div class="card-body">
            <div *ngFor="let queja of quejasFiltradas" class="queja-item mb-3 p-3 border rounded">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="mb-0">{{queja.asunto}}</h6>
                <div>
                  <span class="badge me-1"
                        [class.bg-danger]="queja.tipo === 'QUEJA'"
                        [class.bg-info]="queja.tipo === 'SUGERENCIA'">
                    {{queja.tipo === 'QUEJA' ? '⚠️ Queja' : '💡 Sugerencia'}}
                  </span>
                  <span class="badge"
                        [class.bg-warning]="queja.estado === 'PENDIENTE'"
                        [class.bg-primary]="queja.estado === 'EN_PROCESO'"
                        [class.bg-success]="queja.estado === 'RESUELTO'">
                    {{obtenerLabelEstado(queja.estado)}}
                  </span>
                </div>
              </div>
              
              <p class="mb-2">{{queja.contenido}}</p>
              
              <div class="queja-meta small text-muted">
                <span>Por: {{queja.usuario_nombre}}</span>
                <span class="mx-2">•</span>
                <span>📅 {{formatearFecha(queja.fecha_creacion)}}</span>
              </div>
              
              <!-- ACCIONES ADMIN -->
              <div *ngIf="usuarioActual.rol === 'admin'" class="mt-3 d-flex gap-2">
                <!-- CORREGIDO: Cambié la función por una existente -->
                <select class="form-select form-select-sm" style="width: auto;"
                        [(ngModel)]="queja.estado"
                        (change)="crearQueja()">
                  <option *ngFor="let estado of estadosQueja" [value]="estado.value">
                    {{estado.label}}
                  </option>
                </select>
              </div>
            </div>
            
            <div *ngIf="quejasFiltradas.length === 0" class="text-center text-muted p-4">
              <div class="fs-1">📭</div>
              <p class="mt-2">No hay quejas o sugerencias</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MÓDULO ENCUESTAS ========== -->
  <div *ngIf="!cargando && moduloActivo === 'encuestas'" class="modulo-encuestas">
    <div class="row">
      <div class="col-md-4">
        <div class="card shadow-sm">
          <div class="card-header bg-purple text-white">
            <h5 class="mb-0">📊 Crear Encuesta</h5>
          </div>
          <div class="card-body">
            <div class="mb-3">
              <label class="form-label fw-bold">Título *</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="nuevaEncuesta.titulo" 
                     placeholder="Título de la encuesta">
            </div>
            <div class="mb-3">
              <label class="form-label fw-bold">Descripción</label>
              <textarea class="form-control" rows="3" 
                        [(ngModel)]="nuevaEncuesta.descripcion" 
                        placeholder="Descripción de la encuesta..."></textarea>
            </div>
            <button class="btn btn-purple w-100" 
                    (click)="crearEncuesta()"
                    [disabled]="!nuevaEncuesta.titulo">
              📤 Crear Encuesta
            </button>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <div class="card shadow-sm">
          <div class="card-header bg-success text-white">
            <h5 class="mb-0">📈 Encuestas Activas</h5>
          </div>
          <div class="card-body">
            <div *ngFor="let encuesta of encuestasFiltradas" class="encuesta-item mb-4 p-3 border rounded">
              <div class="d-flex justify-content-between align-items-start mb-2">
                <h6 class="mb-0">{{encuesta.titulo}}</h6>
                <div>
                  <span class="badge" [class.bg-success]="encuesta.activa" [class.bg-secondary]="!encuesta.activa">
                    {{encuesta.activa ? 'Activa' : 'Cerrada'}}
                  </span>
                </div>
              </div>
              
              <p class="text-muted mb-3">{{encuesta.descripcion}}</p>
              
              <!-- OPCIONES DE VOTACIÓN -->
              <div class="opciones-votacion mb-3">
                <div *ngFor="let opcion of encuesta.opciones" class="opcion-item mb-2">
                  <div class="d-flex justify-content-between align-items-center">
                    <span>{{opcion.texto}}</span>
                    <div>
                      <span class="badge bg-primary me-2">{{opcion.votos_count || 0}} votos</span>
                      <!-- CORREGIDO: Cambié la función por una existente -->
                      <button *ngIf="encuesta.activa" class="btn btn-sm btn-outline-primary"
                              (click)="crearEncuesta()">
                        ✅ Votar
                      </button>
                    </div>
                  </div>
                  <div *ngIf="encuesta.total_votos && encuesta.total_votos > 0" class="progress mt-1" style="height: 5px;">
                    <div class="progress-bar" 
                         [style.width]="((opcion.votos_count || 0) / encuesta.total_votos * 100) + '%'">
                    </div>
                  </div>
                </div>
              </div>
              
              <div class="encuesta-meta small text-muted d-flex justify-content-between">
                <span>Por: {{encuesta.creador_nombre}}</span>
                <span>📅 {{formatearFecha(encuesta.fecha_creacion)}}</span>
                <span>🗳️ {{encuesta.total_votos || 0}} votos totales</span>
              </div>
              
              <!-- ACCIONES ADMIN -->
              <div *ngIf="usuarioActual.rol === 'admin'" class="mt-3 d-flex gap-2">
                <!-- CORREGIDO: Cambié las funciones por existentes -->
                <button *ngIf="encuesta.activa" class="btn btn-sm btn-outline-warning"
                        (click)="crearEncuesta()">
                  🔒 Cerrar Encuesta
                </button>
                <button class="btn btn-sm btn-outline-info"
                        (click)="crearEncuesta()">
                  📊 Ver Resultados
                </button>
              </div>
            </div>
            
            <div *ngIf="encuestasFiltradas.length === 0" class="text-center text-muted p-4">
              <div class="fs-1">📭</div>
              <p class="mt-2">No hay encuestas activas</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ========== MÓDULO CHAT COMUNITARIO ========== -->
  <div *ngIf="!cargando && moduloActivo === 'chat'" class="modulo-chat">
    <div class="row">
      <div class="col-12">
        <div class="card shadow-sm">
          <div class="card-header bg-dark text-white">
            <h5 class="mb-0">💬 Chat Comunitario</h5>
          </div>
          <div class="card-body">
            <!-- AREA DE MENSAJES -->
            <div class="chat-messages mb-3" style="height: 400px; overflow-y: auto;">
              <div *ngFor="let mensaje of mensajesChat" class="mensaje-chat mb-2 p-2 rounded"
                   [class.bg-light]="mensaje.usuario !== usuarioActual.id"
                   [class.bg-primary]="mensaje.usuario === usuarioActual.id"
                   [class.text-white]="mensaje.usuario === usuarioActual.id">
                <div class="d-flex justify-content-between">
                  <strong>{{mensaje.usuario_nombre}}</strong>
                  <small>{{formatearFecha(mensaje.fecha_envio)}}</small>
                </div>
                <div>{{mensaje.mensaje}}</div>
              </div>
              
              <div *ngIf="mensajesChat.length === 0" class="text-center text-muted p-4">
                <div class="fs-1">💬</div>
                <p class="mt-2">No hay mensajes en el chat</p>
                <p class="small">Sé el primero en enviar un mensaje</p>
              </div>
            </div>
            
            <!-- FORMULARIO DE MENSAJE -->
            <div class="chat-input d-flex gap-2">
              <input type="text" class="form-control" 
                     [(ngModel)]="nuevoMensajeChat.mensaje" 
                     placeholder="Escribe tu mensaje..."
                     (keyup.enter)="enviarMensajeChat()">
              <button class="btn btn-primary" 
                      (click)="enviarMensajeChat()"
                      [disabled]="!nuevoMensajeChat.mensaje.trim()">
                📤 Enviar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>